{{ template "header" . }}

<script type="text/javascript" class="init">

$(document).ready(function () {
  var collapsedGroups = {};

  $('#dining').DataTable({
    "pageLength": 50,
    "scrollY":    "70vh",
    "scrollCollapse": true,
    "paging": false,
    "ajax": {
      "url": '?api=offers.json',
      "cache": true
    },
    "rowGroup": {
      dataSrc: ["Name"],
      startRender: function (rows, group) {
        var collapsed = !collapsedGroups[group];

        rows.nodes().each(function (r) {
          r.style.display = collapsed ? 'none' : '';
        });   
        return $('<tr/>')
          .append( '<td>'+rows.data().pluck('Location')[0]+'</td>')
          .append( '<td colspan="3"><a href="'+rows.data().pluck('URL')[0]+'">'+group+'</a></td>')
          .attr('data-name', group)
          .toggleClass('collapsed', collapsed);
      }
    },
    "columns": [ 
      { "title": "Location", "data": ".Location" },
      { "title": "Resturant", "data": ".Name",
        "orderable": true,
        "render": 
          function (data, type, row) { 
            return row.Name;
          }
      },
      { "title": "Date", "data": ".Date",
        "orderable": false
      },
      { "title": "Times", "data": ".Time",
        "orderable": false
      }
    ]
  });

  $('#dining tbody').on('click', 'tr.dtrg-start', function () {
    var name = $(this).data('name');
    collapsedGroups[name] = !collapsedGroups[name];
//    $('#dining').DataTable().ajax.reload();
    $('#dining').DataTable().draw(false);
  });  

  //setInterval( function() {$('#DHCPLeases').DataTable().ajax.reload(); }, 5000);
  });
</script> 

<table id="dining" class="table" style="width:90%">
  <thead>
    <tr><th>Location</th><th>Resturant</th><th>Date</th><th>Times</th></tr>
  </thead>
</table>

{{ template "footer" . }}
<!-- vim: noai:ts=2:sw=2:set expandtab: -->

